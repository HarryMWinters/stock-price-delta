<template>
  <div id="app">
    <Nav />
    <MultiGraph v-bind:chart="stackedChart" />
    <ControlPanel
      v-bind:stocks="stocks"
      v-bind:dates="dates"
      v-bind:updater="stockUpdater"
      v-bind:deleter="stockDeleter"
    />
  </div>
</template>

<script>
const axios = require("axios");

import Nav from "./components/nav//Nav.vue";
import ControlPanel from "./components/control-panel/ControlPanel.vue";
import MultiGraph from "./components/mutli-graph/MultiGraph.vue";

export default {
  name: "app",
  components: {
    Nav,
    MultiGraph,
    ControlPanel
  },

  methods: {
    stockUpdater: function(symbol) {
      const apikey = "9TYZNYNMGKH18KZ7";
      axios
        .get("https://www.alphavantage.co/query", {
          params: {
            function: "TIME_SERIES_DAILY",
            symbol: symbol,
            apikey: apikey
          }
        })
        .then(response => {
          const dates = Object.keys(response.data["Time Series (Daily)"]);
          let stockPrices = dates.map(date => {
            return [
              Number(response.data["Time Series (Daily)"][date]["4. close"], 2),
              date
            ];
          });
          this.stocks.push({
            symbol: symbol,
            initialSharePrice: Number(
              response.data["Time Series (Daily)"][this.dates.initial][
                "4. close"
              ]
            ).toFixed(2),
            finalSharePrice: Number(
              response.data["Time Series (Daily)"][this.dates.final]["4. close"]
            ).toFixed(2),
            priceArray: stockPrices
          });
          // Update graph info
          this.stackedChart.series.push({
            name: symbol,
            type: "line",
            stack: "none",
            areaStyle: {},
            data: Object.keys(response.data["Time Series (Daily)"]).map(day => {
              return [
                day,
                response.data["Time Series (Daily)"][day]["4. close"]
              ];
            })
          });
        })
        .catch(() => {
          this.stocks.push({
            symbol: symbol,
            initialSharePrice: null,
            finalSharePrice: null,
            errMsg:
              "Unable to retrieve data for " +
              symbol +
              " in range " +
              this.dates.initial +
              " to " +
              this.dates.final +
              "."
          });
        });
    },
    stockDeleter: function(targetStock) {
      const index = this.stocks.map(s => s.symbol).indexOf(targetStock.symbol);
      this.stocks.splice(index, 1);
    }
  },
  data() {
    return {
      stocks: [
        {
          symbol: "CDNA",
          initialSharePrice: "36.75",
          finalSharePrice: "35.71",
          priceArray: [
            [21.7, "2019-09-06"],
            [22.91, "2019-09-05"],
            [22.29, "2019-09-04"],
            [21.78, "2019-09-03"],
            [22.82, "2019-08-30"],
            [24.15, "2019-08-29"],
            [23.86, "2019-08-28"],
            [23.2, "2019-08-27"],
            [23.35, "2019-08-26"],
            [22.8, "2019-08-23"],
            [23.62, "2019-08-22"],
            [23.74, "2019-08-21"],
            [24.63, "2019-08-20"],
            [24.09, "2019-08-19"],
            [23.63, "2019-08-16"],
            [23.17, "2019-08-15"],
            [23.7, "2019-08-14"],
            [25.08, "2019-08-13"],
            [24.96, "2019-08-12"],
            [24.77, "2019-08-09"],
            [27.04, "2019-08-08"],
            [27.35, "2019-08-07"],
            [27.61, "2019-08-06"],
            [30.67, "2019-08-05"],
            [35.01, "2019-08-02"],
            [34, "2019-08-01"],
            [32.77, "2019-07-31"],
            [34.25, "2019-07-30"],
            [33.07, "2019-07-29"],
            [32.28, "2019-07-26"],
            [31.29, "2019-07-25"],
            [32.98, "2019-07-24"],
            [32.7, "2019-07-23"],
            [33.02, "2019-07-22"],
            [31.72, "2019-07-19"],
            [31.68, "2019-07-18"],
            [30.96, "2019-07-17"],
            [32.57, "2019-07-16"],
            [37.4, "2019-07-15"],
            [38.33, "2019-07-12"],
            [40.08, "2019-07-11"],
            [39.53, "2019-07-10"],
            [38.58, "2019-07-09"],
            [35.39, "2019-07-08"],
            [35.34, "2019-07-05"],
            [36.29, "2019-07-03"],
            [35.71, "2019-07-02"],
            [35.87, "2019-07-01"],
            [35.99, "2019-06-28"],
            [35.97, "2019-06-27"],
            [34.68, "2019-06-26"],
            [35.61, "2019-06-25"],
            [34.23, "2019-06-24"],
            [38.03, "2019-06-21"],
            [38.2, "2019-06-20"],
            [39.77, "2019-06-19"],
            [38.61, "2019-06-18"],
            [38.26, "2019-06-17"],
            [36.92, "2019-06-14"],
            [37.93, "2019-06-13"],
            [38.12, "2019-06-12"],
            [35.76, "2019-06-11"],
            [36.36, "2019-06-10"],
            [37.39, "2019-06-07"],
            [35.87, "2019-06-06"],
            [33.53, "2019-06-05"],
            [33.43, "2019-06-04"],
            [32.8, "2019-06-03"],
            [31.62, "2019-05-31"],
            [32.21, "2019-05-30"],
            [31.07, "2019-05-29"],
            [31.78, "2019-05-28"],
            [31.63, "2019-05-24"],
            [31.9, "2019-05-23"],
            [33.21, "2019-05-22"],
            [33.99, "2019-05-21"],
            [32.43, "2019-05-20"],
            [32.75, "2019-05-17"],
            [34.52, "2019-05-16"],
            [33.65, "2019-05-15"],
            [33.4, "2019-05-14"],
            [32.23, "2019-05-13"],
            [32.27, "2019-05-10"],
            [32.9, "2019-05-09"],
            [29.15, "2019-05-08"],
            [28.62, "2019-05-07"],
            [30.43, "2019-05-06"],
            [30.06, "2019-05-03"],
            [28.38, "2019-05-02"],
            [27.06, "2019-05-01"],
            [27.21, "2019-04-30"],
            [27.61, "2019-04-29"],
            [28.38, "2019-04-26"],
            [25.95, "2019-04-25"],
            [26.46, "2019-04-24"],
            [26.65, "2019-04-23"],
            [25.78, "2019-04-22"],
            [26.5, "2019-04-18"],
            [26.46, "2019-04-17"],
            [28.38, "2019-04-16"]
          ]
        },
        {
          symbol: "AMD",
          initialSharePrice: "31.79",
          finalSharePrice: "31.24",
          priceArray: [
            [30.56, "2019-09-06"],
            [31.5, "2019-09-05"],
            [30.95, "2019-09-04"],
            [30.9, "2019-09-03"],
            [31.45, "2019-08-30"],
            [31.45, "2019-08-29"],
            [30.78, "2019-08-28"],
            [30.2, "2019-08-27"],
            [30.28, "2019-08-26"],
            [29.54, "2019-08-23"],
            [31.9, "2019-08-22"],
            [31.7, "2019-08-21"],
            [30.72, "2019-08-20"],
            [31.48, "2019-08-19"],
            [31.18, "2019-08-16"],
            [29.67, "2019-08-15"],
            [30.24, "2019-08-14"],
            [32.11, "2019-08-13"],
            [32.43, "2019-08-12"],
            [34.19, "2019-08-09"],
            [33.92, "2019-08-08"],
            [29.19, "2019-08-07"],
            [28.86, "2019-08-06"],
            [27.99, "2019-08-05"],
            [29.44, "2019-08-02"],
            [29.86, "2019-08-01"],
            [30.45, "2019-07-31"],
            [33.87, "2019-07-30"],
            [33.48, "2019-07-29"],
            [34.02, "2019-07-26"],
            [33.67, "2019-07-25"],
            [34.11, "2019-07-24"],
            [33.49, "2019-07-23"],
            [32.85, "2019-07-22"],
            [32.51, "2019-07-19"],
            [33, "2019-07-18"],
            [33.6, "2019-07-17"],
            [33.85, "2019-07-16"],
            [34.39, "2019-07-15"],
            [33.21, "2019-07-12"],
            [33.06, "2019-07-11"],
            [33.79, "2019-07-10"],
            [33.15, "2019-07-09"],
            [32.04, "2019-07-08"],
            [31.5, "2019-07-05"],
            [31.19, "2019-07-03"],
            [31.24, "2019-07-02"],
            [31.2, "2019-07-01"],
            [30.37, "2019-06-28"],
            [30.74, "2019-06-27"],
            [29.92, "2019-06-26"],
            [28.86, "2019-06-25"],
            [29.26, "2019-06-24"],
            [29.1, "2019-06-21"],
            [30.01, "2019-06-20"],
            [30.5, "2019-06-19"],
            [30.45, "2019-06-18"],
            [29.2, "2019-06-17"],
            [30.36, "2019-06-14"],
            [31.39, "2019-06-13"],
            [32.18, "2019-06-12"],
            [32.41, "2019-06-11"],
            [33.23, "2019-06-10"],
            [32.41, "2019-06-07"],
            [31.82, "2019-06-06"],
            [29.5, "2019-06-05"],
            [29.57, "2019-06-04"],
            [27.58, "2019-06-03"],
            [27.41, "2019-05-31"],
            [28.03, "2019-05-30"],
            [28.09, "2019-05-29"],
            [29.03, "2019-05-28"],
            [26.44, "2019-05-24"],
            [26.36, "2019-05-23"],
            [27.41, "2019-05-22"],
            [27.35, "2019-05-21"],
            [26.68, "2019-05-20"],
            [27.5, "2019-05-17"],
            [28.01, "2019-05-16"],
            [27.58, "2019-05-15"],
            [27.32, "2019-05-14"],
            [26.24, "2019-05-13"],
            [27.96, "2019-05-10"],
            [27.21, "2019-05-09"],
            [27.09, "2019-05-08"],
            [26.66, "2019-05-07"],
            [27.42, "2019-05-06"],
            [28.22, "2019-05-03"],
            [28.29, "2019-05-02"],
            [26.81, "2019-05-01"],
            [27.63, "2019-04-30"],
            [27.69, "2019-04-29"],
            [27.88, "2019-04-26"],
            [27.66, "2019-04-25"],
            [28.46, "2019-04-24"],
            [27.97, "2019-04-23"],
            [28.18, "2019-04-22"],
            [27.68, "2019-04-18"],
            [27.49, "2019-04-17"],
            [27.93, "2019-04-16"]
          ]
        }
      ],
      dates: {
        initial: "2019-07-01",
        final: "2019-07-02"
      },
      stackedChart: {
        title: {
          text: "Price over time"
        },
        xAxis: [
          {
            type: "time",
            name: "Date",
            min: "dataMin",
            max: "dataMax"
          }
        ],
        yAxis: [
          {
            type: "value",
            name: "Value ($)",
            min: "0",
            max: "dataMax"
          }
        ],
        series: []
      }
    };
  }
};
</script>

<style>
* {
  --black: #020202;
  --eggshell: #ffffff;
  --lime: #8edce6;
  --grey: #454545;
  --forest: #4f9d69;

  --bg-element: #ffffff;
  --border: #45454538;

  margin: 0;
  padding: 0;
}

body {
  height: 100%;
  background: var(--eggshell);
}

#app {
  font-family: "Avenir", Helvetica, Arial, sans-serif;
}
</style>
